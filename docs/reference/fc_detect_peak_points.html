<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Detect points of sudden increase of Rate-of-change values"><title>Detect significant peak points — fc_detect_peak_points • RRatepol</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Detect significant peak points — fc_detect_peak_points"><meta property="og:description" content="Detect points of sudden increase of Rate-of-change values"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">RRatepol</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/package-description.html">General RRatepol package description</a>
    <a class="dropdown-item" href="../articles/workflow-example.html">Example of full workflow</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Detect significant peak points</h1>
      
      <div class="d-none name"><code>fc_detect_peak_points.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Detect points of sudden increase of Rate-of-change values</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fc_detect_peak_points</span><span class="op">(</span></span>
<span>  <span class="va">data_source</span>,</span>
<span>  sel_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trend_linear"</span>, <span class="st">"trend_non_linear"</span>, <span class="st">"threshold"</span>, <span class="st">"GAM_deriv"</span>, <span class="st">"SNI"</span><span class="op">)</span>,</span>
<span>  method <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sd_threshold <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data_source</dt>
<dd><p>Data.frame. Output of <code>fc_estimate_RoC</code> function</p></dd>


<dt>sel_method</dt>
<dd><p>Character. A method to use for peak-poit detection:</p><ul><li><p><code>"threshold"</code> - Each point in the RoC sequence is compared to a median
of all RoC scores from the whole sequence (i.e. threshold value). The RoC
value for a point is considered significant if the 95th quantile of the RoC
scores from all calculations is higher than the threshold value.</p></li>
<li><p><code>"trend_linear"</code> - A linear model is fitted between the RoC values and
their ages. Differences between the model and each point are calculated (residuals).
The standard deviation (SD) is calculated from all the residuals. A peak is considered
significant if it is 2 SD higher than the model (<code>sd_threshold</code> = 2).</p></li>
<li><p><code>"trend_non_linear"</code> - A conservative generalised additive model (GAM)
is fitted through the RoC scores and their ages (GAM = <code>RoC ~ s(age, k = 3)</code>
using the <code>mgcv</code> package (Wood, 2011). The distance between each point and
the fitted value is calculated (residuals). The standard deviation (SD) is
calculated from all the residuals. A peak is considered significant if it
is 2 SD higher than the model (<code>sd_threshold</code> = 2).</p></li>
</ul></dd>


<dt>method</dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated" class="external-link"><img src="figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a></p></dd>


<dt>sd_threshold</dt>
<dd><p>Numeric. Threshold that SD of residuals are compared to, to determine
peak-point (default = 2)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>A rapid change in composition or relative abundances of variables within the
sequence can provide a means of comparing RoC between sequences and interpreting
the potential drivers of assemblage change. To detect such significant peak-points
of RoC scores in each sequence, each point is tested to see if it represents
a significant increase in RoC values. There are various ways to detect
peak-points in a time series and R-Ratepol is able to detect peak-points
using five methods:</p><ul><li><p>Threshold (<code>sel_method</code> = <code>"threshold"</code>) - Each point in the RoC sequence is
compared to a median of all RoC scores from the whole sequence (i.e. threshold value).
The ROC value for a point is considered significant if the 95th quantile of
the RoC scores from all calculations is higher than the threshold value.</p></li>
<li><p>Linear trend (<code>sel_method</code> = <code>"trend_linear"</code>) - A linear model is fitted
between the RoC values and their ages. Differences between the model and each
point are calculated (residuals). The standard deviation (SD) is calculated
from all the residuals. A peak is considered significant if it is 2 SD higher
than the model (<code>sd_threshold</code> = 2).</p></li>
<li><p>Non-linear trend (<code>sel_method</code> = <code>"trend_non_linear"</code>) - A conservative
generalised additive model (GAM) is fitted through the RoC scores and their
ages (GAM = <code>RoC ~ s(age, k = 3)</code> using the <code>mgcv</code> package (Wood, 2011).
The distance between each point and the fitted value is calculated (residuals).
The standard deviation (SD) is calculated from all the residuals. A peak is
considered significant if it is 2 SD higher than the model (<code>sd_threshold</code> = 2).</p></li>
<li><p>F-deriv GAM  (<code>sel_method</code> = <code>"GAM_deriv"</code>) - A smooth GAM model is fitted
to the RoC scores and their ages (GAM = <code>RoC ~ s(age)</code>. The first derivative
as well as continuous confidence intervals are calculated from the model
using the <code>gratia</code> package (Simpson, 2019). A peak is considered significant
if the confidence intervals of the first derivative differ from 0
(for more information see Simpson, 2018).</p></li>
<li><p>Signal-to-noise method (<code>sel_method</code> = <code>"SNI"</code>) - We adapted SNI from
Kelly et al. (2011), which was developed to detect changes in charcoal
stratigraphical records. SNI is calculated for the whole RoC sequence and
a peak-point is considered significant if it has an SNI value higher than 3.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Kelly, R.F., Higuera, P.E., Barrett, C.M., Feng Sheng, H., 2011. A signal-to-noise
index to quantify the potential for peak detection in sediment-charcoal records.
Quat. Res. 75, 11–17.</p>
<p>Simpson, G.L., 2019. gratia: graceful'ggplot'–based graphics and other functions
for GAMs fitted using “mgcv.” R Packag. version 0.2–1.</p>
<p>Simpson, G.L., 2018. Modelling palaeoecological time series using generalised
additive models. Front. Ecol. Evol. 6, 1–21.</p>
<p>Wood, S.N., 2011. Fast stable restricted maximum likelihood and marginal
likelihood estimation of semiparametric generalized linear models.
J. R. Stat. Soc. Ser. B Stat. Methodol. 73, 3–36.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">example_data</span> <span class="op">&lt;-</span> <span class="fu">RRatepol</span><span class="fu">::</span><span class="va"><a href="example_data.html">example_data</a></span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sequence_01</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="fc_estimate_RoC.html">fc_estimate_RoC</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    data_source_community <span class="op">=</span> <span class="va">example_data</span><span class="op">$</span><span class="va">pollen_data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>    data_source_age <span class="op">=</span> <span class="va">example_data</span><span class="op">$</span><span class="va">sample_age</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>    age_uncertainty <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>    smooth_method <span class="op">=</span> <span class="st">"shep"</span>,</span></span>
<span class="r-in"><span>    Working_Units <span class="op">=</span> <span class="st">"MW"</span>,</span></span>
<span class="r-in"><span>    rand <span class="op">=</span> <span class="fl">1e3</span>,</span></span>
<span class="r-in"><span>    treads <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    DC <span class="op">=</span> <span class="st">"chisq"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sequence_01_peak</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu">fc_detect_peak_points</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">sequence_01</span>,</span></span>
<span class="r-in"><span>    sel_method <span class="op">=</span> <span class="st">"trend_non_linear"</span>,</span></span>
<span class="r-in"><span>    sd_threshold <span class="op">=</span> <span class="fl">2</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="fc_plot_RoC_sequence.html">fc_plot_RoC_sequence</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">sequence_01_peak</span>,</span></span>
<span class="r-in"><span>  age_threshold <span class="op">=</span> <span class="fl">8e3</span>,</span></span>
<span class="r-in"><span>  Roc_threshold <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  Peaks <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  trend <span class="op">=</span> <span class="st">"trend_non_linear"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Ondrej Mottl.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

