<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example of full workflow • RRatepol</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example of full workflow">
<meta property="og:description" content="RRatepol">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RRatepol</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/workflow-example.html">Example of full workflow</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="workflow-example_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example of full workflow</h1>
            
      
      
      <div class="hidden name"><code>workflow-example.Rmd</code></div>

    </div>

    
    
<p>This workflow should show full strength of <em>RRatepol package</em> and serve as step by step guidance starting from downloading dataset from Neotoma, building age-depth models, to estimating rate-of-change using age uncertainty.</p>
<div id="import-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#import-packages" class="anchor"></a>import packages</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rapporter.github.io/pander/">pander</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RRatepol</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/neotoma">neotoma</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://andrewcparnell.github.io/Bchron/">Bchron</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor">janitor</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="download-the-dataset-glendalough-valley-from-neotoma" class="section level2">
<h2 class="hasAnchor">
<a href="#download-the-dataset-glendalough-valley-from-neotoma" class="anchor"></a>Download the dataset <em>Glendalough Valley</em> from Neotoma</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gl_dataset_download</span> <span class="op">&lt;-</span> <span class="fu">neotoma</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/neotoma/reference/get_download.html">get_download</a></span><span class="op">(</span><span class="fl">17334</span><span class="op">)</span>

<span class="va">chronology_id</span> <span class="op">&lt;-</span> 
  <span class="va">gl_dataset_download</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample.meta</span><span class="op">$</span><span class="va">chronology.id</span> <span class="op"><a href="https://andrewcparnell.github.io/Bchron/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">gl_chron_control_table_download</span> <span class="op">&lt;-</span> <span class="fu">neotoma</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/neotoma/reference/get_chroncontrol.html">get_chroncontrol</a></span><span class="op">(</span><span class="va">chronology_id</span><span class="op">)</span></code></pre></div>
</div>
<div id="prepare-the-pollen-counts" class="section level2">
<h2 class="hasAnchor">
<a href="#prepare-the-pollen-counts" class="anchor"></a>Prepare the pollen counts</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gl_counts</span> <span class="op">&lt;-</span> 
  <span class="va">gl_dataset_download</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">counts</span> 

<span class="va">gl_taxon_lits</span> <span class="op">&lt;-</span> 
  <span class="va">gl_dataset_download</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">taxon.list</span>

<span class="va">gl_taxon_lits_selected</span> <span class="op">&lt;-</span> 
<span class="va">gl_taxon_lits</span> <span class="op"><a href="https://andrewcparnell.github.io/Bchron/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">variable.element</span> <span class="op">==</span> <span class="st">"pollen"</span><span class="op">)</span>

<span class="va">gl_counts_selected</span> <span class="op">&lt;-</span>
  <span class="va">gl_counts</span> <span class="op"><a href="https://andrewcparnell.github.io/Bchron/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://andrewcparnell.github.io/Bchron/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="va">.</span>, var <span class="op">=</span> <span class="st">"sample_id"</span><span class="op">)</span> <span class="op"><a href="https://andrewcparnell.github.io/Bchron/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://andrewcparnell.github.io/Bchron/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">sample_id</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">any_of</a></span><span class="op">(</span><span class="va">gl_taxon_lits_selected</span><span class="op">$</span><span class="va">taxon.name</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://andrewcparnell.github.io/Bchron/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> 

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">gl_counts_selected</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></code></pre></div>
<table class="table">
<colgroup>
<col width="16%">
<col width="12%">
<col width="11%">
<col width="22%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th align="center">sample_id</th>
<th align="center">alisma</th>
<th align="center">alnus</th>
<th align="center">amaranthaceae</th>
<th align="center">anthemis_type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">161508</td>
<td align="center">0</td>
<td align="center">20</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">161509</td>
<td align="center">1</td>
<td align="center">12</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">161510</td>
<td align="center">0</td>
<td align="center">30</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">161511</td>
<td align="center">0</td>
<td align="center">34</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">161512</td>
<td align="center">0</td>
<td align="center">27</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">161513</td>
<td align="center">0</td>
<td align="center">24</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<p>Here, we strongly advocate that attention should be paid to the section of ecological ecological group, as well, as harmonisation of the pollen taxa. However, that is not subject of this workflow.</p>
</div>
<div id="preparation-of-the-levels" class="section level2">
<h2 class="hasAnchor">
<a href="#preparation-of-the-levels" class="anchor"></a>Preparation of the levels</h2>
<div id="sample-depth" class="section level3">
<h3 class="hasAnchor">
<a href="#sample-depth" class="anchor"></a>Sample depth</h3>
<p>Extract depth for each level</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gl_level</span> <span class="op">&lt;-</span>
  <span class="va">gl_dataset_download</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample.meta</span> <span class="op"><a href="https://andrewcparnell.github.io/Bchron/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://andrewcparnell.github.io/Bchron/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>sample_id <span class="op">=</span> <span class="va">sample.id</span><span class="op">)</span> <span class="op"><a href="https://andrewcparnell.github.io/Bchron/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">sample_id</span>, <span class="va">depth</span><span class="op">)</span> <span class="op"><a href="https://andrewcparnell.github.io/Bchron/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_if</a></span><span class="op">(</span><span class="va">is.integer</span>, <span class="va">as.character</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">gl_level</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="16%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="center">sample_id</th>
<th align="center">depth</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">161508</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">161509</td>
<td align="center">8</td>
</tr>
<tr class="odd">
<td align="center">161510</td>
<td align="center">16</td>
</tr>
<tr class="even">
<td align="center">161511</td>
<td align="center">24</td>
</tr>
<tr class="odd">
<td align="center">161512</td>
<td align="center">32</td>
</tr>
<tr class="even">
<td align="center">161513</td>
<td align="center">40</td>
</tr>
</tbody>
</table>
</div>
<div id="age-depth-modelling" class="section level3">
<h3 class="hasAnchor">
<a href="#age-depth-modelling" class="anchor"></a>Age depth modelling</h3>
<p>We will recalculate new age-depth model ‘de novo’ using <em>Bchron</em> package. In this toy example we will use only iteration multiplier (<em>i_multiplier</em>) of 1 to reduce the computation time. However, we strongly recommend to increase it to 5 for any normal age-depth model construction.</p>
<p>Prepare chron.control table and run Bchron Here we only present few of the important steps of preparation of chron.control table. There are many more potential issues issues but solving those is not the focus of this workflow.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gl_chron_control_table</span> <span class="op">&lt;-</span>
  <span class="va">gl_chron_control_table_download</span><span class="op">$</span><span class="va">chron.control</span> <span class="op"><a href="https://andrewcparnell.github.io/Bchron/reference/pipe.html">%&gt;%</a></span> 
   <span class="co"># here we calculate the error as the avarage as the age.old and age age.young</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">age.old</span> <span class="op">-</span> <span class="va">age.young</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://andrewcparnell.github.io/Bchron/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># as Bchron cannot accept error of 0, we need to replace the value with 1 </span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="va">error</span>, <span class="va">error</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://andrewcparnell.github.io/Bchron/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># we need to specifify which calibration curve should be used for what point</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    curve <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">control.type</span> <span class="op">==</span> <span class="st">"Radiocarbon"</span>, <span class="st">"intcal20"</span>, <span class="st">"normal"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://andrewcparnell.github.io/Bchron/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">chron.control.id</span>, <span class="va">age</span>, <span class="va">error</span>, <span class="va">depth</span>, <span class="va">thickness</span>, <span class="va">control.type</span>, <span class="va">curve</span><span class="op">)</span>

<span class="va">gl_chron_control_table</span></code></pre></div>
<table class="table">
<colgroup>
<col width="23%">
<col width="9%">
<col width="9%">
<col width="9%">
<col width="14%">
<col width="18%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="center">chron.control.id</th>
<th align="center">age</th>
<th align="center">error</th>
<th align="center">depth</th>
<th align="center">thickness</th>
<th align="center">control.type</th>
<th align="center">curve</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">37155</td>
<td align="center">-45</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">Core top</td>
<td align="center">normal</td>
</tr>
<tr class="even">
<td align="center">37156</td>
<td align="center">1650</td>
<td align="center">60</td>
<td align="center">210</td>
<td align="center">3</td>
<td align="center">Radiocarbon</td>
<td align="center">intcal20</td>
</tr>
<tr class="odd">
<td align="center">37157</td>
<td align="center">2310</td>
<td align="center">30</td>
<td align="center">426</td>
<td align="center">4</td>
<td align="center">Radiocarbon</td>
<td align="center">intcal20</td>
</tr>
<tr class="even">
<td align="center">37158</td>
<td align="center">2500</td>
<td align="center">30</td>
<td align="center">630</td>
<td align="center">4</td>
<td align="center">Radiocarbon</td>
<td align="center">intcal20</td>
</tr>
<tr class="odd">
<td align="center">37159</td>
<td align="center">4060</td>
<td align="center">30</td>
<td align="center">1056</td>
<td align="center">3</td>
<td align="center">Radiocarbon</td>
<td align="center">intcal20</td>
</tr>
<tr class="even">
<td align="center">37160</td>
<td align="center">4460</td>
<td align="center">50</td>
<td align="center">1105</td>
<td align="center">4</td>
<td align="center">Radiocarbon</td>
<td align="center">intcal20</td>
</tr>
<tr class="odd">
<td align="center">37161</td>
<td align="center">9150</td>
<td align="center">50</td>
<td align="center">1166</td>
<td align="center">4</td>
<td align="center">Radiocarbon</td>
<td align="center">intcal20</td>
</tr>
<tr class="even">
<td align="center">37162</td>
<td align="center">9810</td>
<td align="center">60</td>
<td align="center">1204</td>
<td align="center">4</td>
<td align="center">Radiocarbon</td>
<td align="center">intcal20</td>
</tr>
<tr class="odd">
<td align="center">37163</td>
<td align="center">10940</td>
<td align="center">60</td>
<td align="center">1383</td>
<td align="center">4</td>
<td align="center">Radiocarbon</td>
<td align="center">intcal20</td>
</tr>
<tr class="even">
<td align="center">37164</td>
<td align="center">11550</td>
<td align="center">60</td>
<td align="center">1433</td>
<td align="center">3</td>
<td align="center">Radiocarbon</td>
<td align="center">intcal20</td>
</tr>
<tr class="odd">
<td align="center">37165</td>
<td align="center">20300</td>
<td align="center">70</td>
<td align="center">1456</td>
<td align="center">4</td>
<td align="center">Radiocarbon</td>
<td align="center">intcal20</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">i_multiplier</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="co"># increase to 5</span>

<span class="va">n_iteration_default</span> <span class="op">&lt;-</span> <span class="fl">10e3</span>
<span class="va">n_burn_default</span> <span class="op">&lt;-</span> <span class="fl">2e3</span>
<span class="va">n_thin_default</span> <span class="op">&lt;-</span> <span class="fl">8</span>

<span class="va">n_iteration</span> <span class="op">&lt;-</span> <span class="va">n_iteration_default</span> <span class="op">*</span> <span class="va">i_multiplier</span>
<span class="va">n_burn</span> <span class="op">&lt;-</span> <span class="va">n_burn_default</span> <span class="op">*</span> <span class="va">i_multiplier</span>
<span class="va">n_thin</span> <span class="op">&lt;-</span> <span class="va">n_thin_default</span> <span class="op">*</span> <span class="va">i_multiplier</span>

<span class="va">gl_bchron</span> <span class="op">&lt;-</span> 
  <span class="fu">Bchron</span><span class="fu">::</span><span class="fu"><a href="https://andrewcparnell.github.io/Bchron/reference/Bchronology.html">Bchronology</a></span><span class="op">(</span>
    ages <span class="op">=</span> <span class="va">gl_chron_control_table</span><span class="op">$</span><span class="va">age</span>,
    ageSds <span class="op">=</span> <span class="va">gl_chron_control_table</span><span class="op">$</span><span class="va">error</span>,
    positions <span class="op">=</span> <span class="va">gl_chron_control_table</span><span class="op">$</span><span class="va">depth</span>,
    calCurves <span class="op">=</span> <span class="va">gl_chron_control_table</span><span class="op">$</span><span class="va">curve</span>,
    positionThicknesses <span class="op">=</span> <span class="va">gl_chron_control_table</span><span class="op">$</span><span class="va">thickness</span>,
    iterations <span class="op">=</span> <span class="va">n_iteration</span>,
    burn <span class="op">=</span> <span class="va">n_burn</span>,
    thin <span class="op">=</span> <span class="va">n_thin</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gl_bchron</span><span class="op">)</span></code></pre></div>
<p><img src="workflow-example_files/figure-html/bchron_figure-1.png" width="700"></p>
<p>Predict ages</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">age_position</span> <span class="op">&lt;-</span> 
  <span class="fu">Bchron</span><span class="fu">:::</span><span class="fu"><a href="https://andrewcparnell.github.io/Bchron/reference/predict.BchronologyRun.html">predict.BchronologyRun</a></span><span class="op">(</span><span class="va">gl_bchron</span>, newPositions <span class="op">=</span> <span class="va">gl_level</span><span class="op">$</span><span class="va">depth</span><span class="op">)</span>
  
<span class="va">age_uncertainties</span> <span class="op">&lt;-</span> 
  <span class="va">age_position</span> <span class="op"><a href="https://andrewcparnell.github.io/Bchron/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://andrewcparnell.github.io/Bchron/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_all</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">as.integer</span><span class="op">)</span> <span class="op"><a href="https://andrewcparnell.github.io/Bchron/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span>
  
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">age_uncertainties</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">gl_level</span><span class="op">$</span><span class="va">sample_id</span>

<span class="va">gl_level_predicted</span> <span class="op">&lt;-</span> 
  <span class="va">gl_level</span> <span class="op"><a href="https://andrewcparnell.github.io/Bchron/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span>
    <span class="va">age_uncertainties</span>, <span class="fl">2</span>,
    <span class="fu">stats</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>,
    probs <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
  <span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">gl_level_predicted</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="16%">
<col width="11%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="center">sample_id</th>
<th align="center">depth</th>
<th align="center">age</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">161508</td>
<td align="center">0</td>
<td align="center">-45</td>
</tr>
<tr class="even">
<td align="center">161509</td>
<td align="center">8</td>
<td align="center">14</td>
</tr>
<tr class="odd">
<td align="center">161510</td>
<td align="center">16</td>
<td align="center">74</td>
</tr>
<tr class="even">
<td align="center">161511</td>
<td align="center">24</td>
<td align="center">134</td>
</tr>
<tr class="odd">
<td align="center">161512</td>
<td align="center">32</td>
<td align="center">194</td>
</tr>
<tr class="even">
<td align="center">161513</td>
<td align="center">40</td>
<td align="center">253</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="estimation-rate-of-change" class="section level2">
<h2 class="hasAnchor">
<a href="#estimation-rate-of-change" class="anchor"></a>Estimation Rate-of-Change</h2>
<p>Here we use the the prepared data to estimate the rate of vegetation change. We will use the method of the <em>binning with the mowing window</em>, <em>Shepard’s 5-term filter</em> as data smoothing <em>Chi-squared coefficient</em> as dissimilarity coefficient. This is again a toy example for a quick computation and we would recommend increasing the <em>randomisations</em> to 10.000 for any real estimation.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">randomisations</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># increase to 10e3</span>

<span class="va">gl_roc</span> <span class="op">&lt;-</span>
    <span class="fu">RRatepol</span><span class="fu">::</span><span class="fu"><a href="../reference/fc_estimate_RoC.html">fc_estimate_RoC</a></span><span class="op">(</span>
      data_source_community <span class="op">=</span> <span class="va">gl_counts_selected</span>,
      data_source_age <span class="op">=</span> <span class="va">gl_level_predicted</span>,
      age_uncertainty <span class="op">=</span> <span class="va">age_uncertainties</span>,
      smooth_method <span class="op">=</span> <span class="st">"shep"</span>,
      DC <span class="op">=</span> <span class="st">"chisq"</span>,
      Working_Units <span class="op">=</span> <span class="st">"MW"</span>,
      bin_size <span class="op">=</span> <span class="fl">500</span>,
      Number_of_shifts  <span class="op">=</span> <span class="fl">5</span>,
      standardise <span class="op">=</span> <span class="cn">TRUE</span>,
      N_individuals <span class="op">=</span> <span class="fl">150</span>,
      rand <span class="op">=</span> <span class="va">randomisations</span>,
      treads <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># treads = TRUE to use parallel calculation</span></code></pre></div>
<div id="detect-peak-points-and-plot-the-results" class="section level3">
<h3 class="hasAnchor">
<a href="#detect-peak-points-and-plot-the-results" class="anchor"></a>Detect peak-points and plot the results</h3>
<p>We will detect significant peak-points using <em>Non-linear</em> method</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gl_roc_peaks</span> <span class="op">&lt;-</span>
  <span class="fu">RRatepol</span><span class="fu">::</span><span class="fu"><a href="../reference/fc_detect_peak_points.html">fc_detect_peak_points</a></span><span class="op">(</span>
    data_source <span class="op">=</span> <span class="va">gl_roc</span>,
    method <span class="op">=</span> <span class="st">"trend_non_linear"</span><span class="op">)</span></code></pre></div>
<p>Plot the estimates with showing both the peak-points</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">RRatepol</span><span class="fu">::</span><span class="fu"><a href="../reference/fc_plot_RoC_sequence.html">fc_plot_RoC_sequence</a></span><span class="op">(</span>
  data_source <span class="op">=</span> <span class="va">gl_roc_peaks</span>,
  age_threshold <span class="op">=</span> <span class="fl">8e3</span>,
  Roc_threshold <span class="op">=</span> <span class="fl">0.5</span>,
  Peaks <span class="op">=</span> <span class="cn">TRUE</span>,
  trend <span class="op">=</span> <span class="st">"trend_non_linear"</span><span class="op">)</span></code></pre></div>
<p><img src="workflow-example_files/figure-html/roc_figure-1.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ondrej Mottl.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
