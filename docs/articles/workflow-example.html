<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="RRatepol">
<title>Example of full workflow • RRatepol</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example of full workflow">
<meta property="og:description" content="RRatepol">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">RRatepol</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/package-description.html">General RRatepol package description</a>
    <a class="dropdown-item" href="../articles/workflow-example.html">Example of full workflow</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Example of full workflow</h1>
            
      
      
      <div class="d-none name"><code>workflow-example.Rmd</code></div>
    </div>

    
    
<p>This workflow should show full strength of <em>RRatepol package</em>
and serve as step by step guidance starting from downloading dataset
from Neotoma, building age-depth models, to estimating rate-of-change
using age uncertainty.</p>
<p>:warning: <strong>This workflow is only meant as example</strong>:
There are several additional steps for data reparation which should be
done to really use the data from Neotoma!</p>
<div class="section level2">
<h2 id="import-packages">import packages<a class="anchor" aria-label="anchor" href="#import-packages"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rapporter.github.io/pander/" class="external-link">pander</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hope-uib-bio.github.io/R-Ratepol-package/">RRatepol</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/neotoma" class="external-link">neotoma</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://andrewcparnell.github.io/Bchron/" class="external-link">Bchron</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor" class="external-link">janitor</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="download-the-dataset-glendalough-valley-from-neotoma">Download the dataset <em>Glendalough Valley</em> from Neotoma<a class="anchor" aria-label="anchor" href="#download-the-dataset-glendalough-valley-from-neotoma"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gl_dataset_download</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">neotoma</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/neotoma/reference/get_download.html" class="external-link">get_download</a></span><span class="op">(</span><span class="fl">17334</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chronology_id</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">gl_dataset_download</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample.meta</span><span class="op">$</span><span class="va">chronology.id</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gl_chron_control_table_download</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">neotoma</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/neotoma/reference/get_chroncontrol.html" class="external-link">get_chroncontrol</a></span><span class="op">(</span><span class="va">chronology_id</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prepare-the-pollen-counts">Prepare the pollen counts<a class="anchor" aria-label="anchor" href="#prepare-the-pollen-counts"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gl_counts</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">gl_dataset_download</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">counts</span> </span>
<span></span>
<span><span class="va">gl_taxon_list</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">gl_dataset_download</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">taxon.list</span></span>
<span></span>
<span><span class="va">gl_taxon_list_selected</span> <span class="op">&lt;-</span> </span>
<span><span class="va">gl_taxon_list</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable.element</span> <span class="op">==</span> <span class="st">"pollen"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gl_counts_selected</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">gl_counts</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="va">.</span>, var <span class="op">=</span> <span class="st">"sample_id"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sample_id</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="va">gl_taxon_list_selected</span><span class="op">$</span><span class="va">taxon.name</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html" class="external-link">clean_names</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">gl_counts_selected</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<table style="width:85%;" class="table">
<colgroup>
<col width="16%">
<col width="12%">
<col width="11%">
<col width="22%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th align="center">sample_id</th>
<th align="center">alisma</th>
<th align="center">alnus</th>
<th align="center">amaranthaceae</th>
<th align="center">anthemis_type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">161508</td>
<td align="center">0</td>
<td align="center">20</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">161509</td>
<td align="center">1</td>
<td align="center">12</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">161510</td>
<td align="center">0</td>
<td align="center">30</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">161511</td>
<td align="center">0</td>
<td align="center">34</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">161512</td>
<td align="center">0</td>
<td align="center">27</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">161513</td>
<td align="center">0</td>
<td align="center">24</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<p>Here, we strongly advocate that attention should be paid to the
section of ecological ecological group, as well, as harmonisation of the
pollen taxa. However, that is not subject of this workflow.</p>
</div>
<div class="section level2">
<h2 id="preparation-of-the-levels">Preparation of the levels<a class="anchor" aria-label="anchor" href="#preparation-of-the-levels"></a>
</h2>
<div class="section level3">
<h3 id="sample-depth">Sample depth<a class="anchor" aria-label="anchor" href="#sample-depth"></a>
</h3>
<p>Extract depth for each level</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gl_level</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">gl_dataset_download</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample.meta</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>sample_id <span class="op">=</span> <span class="va">sample.id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sample_id</span>, <span class="va">depth</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if</a></span><span class="op">(</span><span class="va">is.integer</span>, <span class="va">as.character</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">gl_level</span><span class="op">)</span></span></code></pre></div>
<table style="width:28%;" class="table">
<colgroup>
<col width="16%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="center">sample_id</th>
<th align="center">depth</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">161508</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">161509</td>
<td align="center">8</td>
</tr>
<tr class="odd">
<td align="center">161510</td>
<td align="center">16</td>
</tr>
<tr class="even">
<td align="center">161511</td>
<td align="center">24</td>
</tr>
<tr class="odd">
<td align="center">161512</td>
<td align="center">32</td>
</tr>
<tr class="even">
<td align="center">161513</td>
<td align="center">40</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="age-depth-modelling">Age depth modelling<a class="anchor" aria-label="anchor" href="#age-depth-modelling"></a>
</h3>
<p>We will recalculate new age-depth model ‘de novo’ using
<em>Bchron</em> package. In this toy example we will use only iteration
multiplier (<em>i_multiplier</em>) of 0.5 to reduce the computation
time. However, we strongly recommend to increase it to 5 for any normal
age-depth model construction.</p>
<p>Prepare chron.control table and run Bchron Here we only present few
of the important steps of preparation of chron.control table. There are
many more potential issues issues but solving those is not the focus of
this workflow.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gl_chron_control_table</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">gl_chron_control_table_download</span><span class="op">$</span><span class="va">chron.control</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>   <span class="co"># here we calculate the error as the avarage as the age.old and age age.young</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">age.old</span> <span class="op">-</span> <span class="va">age.young</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># as Bchron cannot accept error of 0, we need to replace the value with 1 </span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">error</span>, <span class="va">error</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># we need to specifify which calibration curve should be used for what point</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    curve <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">control.type</span> <span class="op">==</span> <span class="st">"Radiocarbon"</span>, <span class="st">"intcal20"</span>, <span class="st">"normal"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">chron.control.id</span>, <span class="va">age</span>, <span class="va">error</span>, <span class="va">depth</span>, <span class="va">thickness</span>, <span class="va">control.type</span>, <span class="va">curve</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gl_chron_control_table</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="23%">
<col width="9%">
<col width="9%">
<col width="9%">
<col width="14%">
<col width="18%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="center">chron.control.id</th>
<th align="center">age</th>
<th align="center">error</th>
<th align="center">depth</th>
<th align="center">thickness</th>
<th align="center">control.type</th>
<th align="center">curve</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">37155</td>
<td align="center">-45</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">Core top</td>
<td align="center">normal</td>
</tr>
<tr class="even">
<td align="center">37156</td>
<td align="center">1650</td>
<td align="center">60</td>
<td align="center">210</td>
<td align="center">3</td>
<td align="center">Radiocarbon</td>
<td align="center">intcal20</td>
</tr>
<tr class="odd">
<td align="center">37157</td>
<td align="center">2310</td>
<td align="center">30</td>
<td align="center">426</td>
<td align="center">4</td>
<td align="center">Radiocarbon</td>
<td align="center">intcal20</td>
</tr>
<tr class="even">
<td align="center">37158</td>
<td align="center">2500</td>
<td align="center">30</td>
<td align="center">630</td>
<td align="center">4</td>
<td align="center">Radiocarbon</td>
<td align="center">intcal20</td>
</tr>
<tr class="odd">
<td align="center">37159</td>
<td align="center">4060</td>
<td align="center">30</td>
<td align="center">1056</td>
<td align="center">3</td>
<td align="center">Radiocarbon</td>
<td align="center">intcal20</td>
</tr>
<tr class="even">
<td align="center">37160</td>
<td align="center">4460</td>
<td align="center">50</td>
<td align="center">1105</td>
<td align="center">4</td>
<td align="center">Radiocarbon</td>
<td align="center">intcal20</td>
</tr>
<tr class="odd">
<td align="center">37161</td>
<td align="center">9150</td>
<td align="center">50</td>
<td align="center">1166</td>
<td align="center">4</td>
<td align="center">Radiocarbon</td>
<td align="center">intcal20</td>
</tr>
<tr class="even">
<td align="center">37162</td>
<td align="center">9810</td>
<td align="center">60</td>
<td align="center">1204</td>
<td align="center">4</td>
<td align="center">Radiocarbon</td>
<td align="center">intcal20</td>
</tr>
<tr class="odd">
<td align="center">37163</td>
<td align="center">10940</td>
<td align="center">60</td>
<td align="center">1383</td>
<td align="center">4</td>
<td align="center">Radiocarbon</td>
<td align="center">intcal20</td>
</tr>
<tr class="even">
<td align="center">37164</td>
<td align="center">11550</td>
<td align="center">60</td>
<td align="center">1433</td>
<td align="center">3</td>
<td align="center">Radiocarbon</td>
<td align="center">intcal20</td>
</tr>
<tr class="odd">
<td align="center">37165</td>
<td align="center">20300</td>
<td align="center">70</td>
<td align="center">1456</td>
<td align="center">4</td>
<td align="center">Radiocarbon</td>
<td align="center">intcal20</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">i_multiplier</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="co"># increase to 5</span></span>
<span></span>
<span><span class="va">n_iteration_default</span> <span class="op">&lt;-</span> <span class="fl">10e3</span></span>
<span><span class="va">n_burn_default</span> <span class="op">&lt;-</span> <span class="fl">2e3</span></span>
<span><span class="va">n_thin_default</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span></span>
<span><span class="va">n_iteration</span> <span class="op">&lt;-</span> <span class="va">n_iteration_default</span> <span class="op">*</span> <span class="va">i_multiplier</span></span>
<span><span class="va">n_burn</span> <span class="op">&lt;-</span> <span class="va">n_burn_default</span> <span class="op">*</span> <span class="va">i_multiplier</span></span>
<span><span class="va">n_thin</span> <span class="op">&lt;-</span> <span class="va">n_thin_default</span> <span class="op">*</span> <span class="va">i_multiplier</span></span>
<span></span>
<span><span class="va">gl_bchron</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">Bchron</span><span class="fu">::</span><span class="fu"><a href="https://andrewcparnell.github.io/Bchron/reference/Bchronology.html" class="external-link">Bchronology</a></span><span class="op">(</span></span>
<span>    ages <span class="op">=</span> <span class="va">gl_chron_control_table</span><span class="op">$</span><span class="va">age</span>,</span>
<span>    ageSds <span class="op">=</span> <span class="va">gl_chron_control_table</span><span class="op">$</span><span class="va">error</span>,</span>
<span>    positions <span class="op">=</span> <span class="va">gl_chron_control_table</span><span class="op">$</span><span class="va">depth</span>,</span>
<span>    calCurves <span class="op">=</span> <span class="va">gl_chron_control_table</span><span class="op">$</span><span class="va">curve</span>,</span>
<span>    positionThicknesses <span class="op">=</span> <span class="va">gl_chron_control_table</span><span class="op">$</span><span class="va">thickness</span>,</span>
<span>    iterations <span class="op">=</span> <span class="va">n_iteration</span>,</span>
<span>    burn <span class="op">=</span> <span class="va">n_burn</span>,</span>
<span>    thin <span class="op">=</span> <span class="va">n_thin</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gl_bchron</span><span class="op">)</span></span></code></pre></div>
<p><img src="workflow-example_files/figure-html/bchron_figure-1.png" width="700"></p>
<p>Predict ages</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age_position</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">Bchron</span><span class="fu">:::</span><span class="fu"><a href="https://andrewcparnell.github.io/Bchron/reference/predict.BchronologyRun.html" class="external-link">predict.BchronologyRun</a></span><span class="op">(</span><span class="va">gl_bchron</span>, newPositions <span class="op">=</span> <span class="va">gl_level</span><span class="op">$</span><span class="va">depth</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">age_uncertainties</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">age_position</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_all</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">as.integer</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">age_uncertainties</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">gl_level</span><span class="op">$</span><span class="va">sample_id</span></span>
<span></span>
<span><span class="va">gl_level_predicted</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">gl_level</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span></span>
<span>    <span class="va">age_uncertainties</span>, <span class="fl">2</span>,</span>
<span>    <span class="fu">stats</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span>,</span>
<span>    probs <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">gl_level_predicted</span><span class="op">)</span></span></code></pre></div>
<table style="width:39%;" class="table">
<colgroup>
<col width="16%">
<col width="11%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="center">sample_id</th>
<th align="center">depth</th>
<th align="center">age</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">161508</td>
<td align="center">0</td>
<td align="center">-45</td>
</tr>
<tr class="even">
<td align="center">161509</td>
<td align="center">8</td>
<td align="center">15</td>
</tr>
<tr class="odd">
<td align="center">161510</td>
<td align="center">16</td>
<td align="center">75.5</td>
</tr>
<tr class="even">
<td align="center">161511</td>
<td align="center">24</td>
<td align="center">136</td>
</tr>
<tr class="odd">
<td align="center">161512</td>
<td align="center">32</td>
<td align="center">196</td>
</tr>
<tr class="even">
<td align="center">161513</td>
<td align="center">40</td>
<td align="center">255</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="estimation-rate-of-change">Estimation Rate-of-Change<a class="anchor" aria-label="anchor" href="#estimation-rate-of-change"></a>
</h2>
<p>Here we use the the prepared data to estimate the rate of vegetation
change. We will use the method of the <em>binning with the mowing
window</em>, <em>Shepard’s 5-term filter</em> as data smoothing
<em>Chi-squared coefficient</em> as dissimilarity coefficient. This is
again a toy example for a quick computation and we would recommend
increasing the <em>randomisations</em> to 10.000 for any real
estimation.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">randomisations</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># increase to 10e3</span></span>
<span></span>
<span><span class="va">gl_roc</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">RRatepol</span><span class="fu">::</span><span class="fu"><a href="../reference/fc_estimate_RoC.html">fc_estimate_RoC</a></span><span class="op">(</span></span>
<span>      data_source_community <span class="op">=</span> <span class="va">gl_counts_selected</span>,</span>
<span>      data_source_age <span class="op">=</span> <span class="va">gl_level_predicted</span>,</span>
<span>      age_uncertainty <span class="op">=</span> <span class="va">age_uncertainties</span>,</span>
<span>      smooth_method <span class="op">=</span> <span class="st">"shep"</span>,</span>
<span>      DC <span class="op">=</span> <span class="st">"chisq"</span>,</span>
<span>      Working_Units <span class="op">=</span> <span class="st">"MW"</span>,</span>
<span>      bin_size <span class="op">=</span> <span class="fl">500</span>,</span>
<span>      Number_of_shifts  <span class="op">=</span> <span class="fl">5</span>,</span>
<span>      standardise <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      N_individuals <span class="op">=</span> <span class="fl">150</span>,</span>
<span>      rand <span class="op">=</span> <span class="va">randomisations</span>,</span>
<span>      use_parallel <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># use_parallel = TRUE to use parallel calculation</span></span>
<span>      <span class="op">)</span> </span></code></pre></div>
<div class="section level3">
<h3 id="detect-peak-points-and-plot-the-results">Detect peak-points and plot the results<a class="anchor" aria-label="anchor" href="#detect-peak-points-and-plot-the-results"></a>
</h3>
<p>We will detect significant peak-points using <em>Non-linear</em>
method</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gl_roc_peaks</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">RRatepol</span><span class="fu">::</span><span class="fu"><a href="../reference/fc_detect_peak_points.html">fc_detect_peak_points</a></span><span class="op">(</span></span>
<span>    data_source <span class="op">=</span> <span class="va">gl_roc</span>,</span>
<span>    sel_method <span class="op">=</span> <span class="st">"trend_non_linear"</span><span class="op">)</span></span></code></pre></div>
<p>Plot the estimates with showing both the peak-points</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">RRatepol</span><span class="fu">::</span><span class="fu"><a href="../reference/fc_plot_RoC_sequence.html">fc_plot_RoC_sequence</a></span><span class="op">(</span></span>
<span>  data_source <span class="op">=</span> <span class="va">gl_roc_peaks</span>,</span>
<span>  Peaks <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  trend <span class="op">=</span> <span class="st">"trend_non_linear"</span><span class="op">)</span></span></code></pre></div>
<p><img src="workflow-example_files/figure-html/roc_figure-1.png" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Ondrej Mottl.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
